(function(g){g.fn.extend({tableExport:function(n){function q(l,h,e,f){g(l).filter(":visible").find(h).each(function(l){if("none"!=g(this).css("display")&&"none"!=g(this).data("tableexport-display")&&-1==a.ignoreColumn.indexOf(l)&&"function"===typeof f){var h=0;if("undefined"!=typeof v[e]&&0<v[e].length)for(c=0;c<=l;c++)"undefined"!=typeof v[e][c]&&(f(null,e,c),delete v[e][c],l++);f(this,e,l);if(g(this).is("[colspan]"))for(h=g(this).attr("colspan"),c=0;c<h-1;c++)f(null,e,l+c);if(g(this).is("[rowspan]")){var b=
parseInt(g(this).attr("rowspan"));for(r=1;r<b;r++)for("undefined"==typeof v[e+r]&&(v[e+r]=[]),v[e+r][l]="",c=1;c<h;c++)v[e+r][l+c]=""}}})}function B(l){!0===a.consoleLog&&console.log(l.output());if("string"==a.outputMode)return l.output();if("base64"==a.outputMode)return w(l.output());try{var h=l.output("blob");saveAs(h,a.fileName+".pdf")}catch(e){x(a.fileName+".pdf","data:application/pdf;base64,"+w(l.output()))}}function C(l,h,e){var f="";if(null!=l)if(h=t(l,h,e),l=null===h||""==h?"":h.toString(),
h instanceof Date)f=a.csvEnclosure+h.toLocaleString()+a.csvEnclosure;else if(h=a.csvEnclosure+a.csvEnclosure,f=l.replace(new RegExp(a.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),h),0<=f.indexOf(a.csvSeparator)||/[\r\n ]/g.test(f))f=a.csvEnclosure+f+a.csvEnclosure;return f}function t(l,h,e){var f="";null!=l&&(l=g(l),f=!0===a.htmlContent?l.html().trim():l.text().trim().replace(/\u00AD/g,""),!0===a.escape&&(f=escape(f)),"function"===typeof a.onCellData&&(f=a.onCellData(l,h,e,f)));
return f}function H(a,h,e){return h+"-"+e.toLowerCase()}function D(a,h,e){window.getComputedStyle?(h=h.replace(/([a-z])([A-Z])/,H),h=window.getComputedStyle(a,null).getPropertyValue(h)):h=a.currentStyle?a.currentStyle[h]:a.style[h];h=h.match(/\d+/);if(null!==h){h=h[0];var f=document.createElement("div");f.style.overflow="hidden";f.style.visibility="hidden";a.parentElement.appendChild(f);f.style.width=100+e;e=100/f.offsetWidth;a.parentElement.removeChild(f);return h*e}return 0}function x(a,h){var e=
document.createElement("a");if(e){document.body.appendChild(e);e.style="display: none";e.download=a;e.href=h;if(document.createEvent)null==z&&(z=document.createEvent("MouseEvents")),z.initEvent("click",!0,!1),e.dispatchEvent(z);else if(document.createEventObject)e.fireEvent("onclick");else if("function"==typeof e.onclick)e.onclick();document.body.removeChild(e)}}function w(a){var h="",e,f,b,d,g,k,m=0;a=a.replace(/\x0d\x0a/g,"\n");f="";for(b=0;b<a.length;b++)d=a.charCodeAt(b),128>d?f+=String.fromCharCode(d):
(127<d&&2048>d?f+=String.fromCharCode(d>>6|192):(f+=String.fromCharCode(d>>12|224),f+=String.fromCharCode(d>>6&63|128)),f+=String.fromCharCode(d&63|128));for(a=f;m<a.length;)e=a.charCodeAt(m++),f=a.charCodeAt(m++),b=a.charCodeAt(m++),d=e>>2,e=(e&3)<<4|f>>4,g=(f&15)<<2|b>>6,k=b&63,isNaN(f)?g=k=64:isNaN(b)&&(k=64),h=h+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return h}var a={csvSeparator:",",csvEnclosure:'"',onCellData:null,ignoreColumn:[],displayTableName:!1,theadSelector:"tr",tbodySelector:"tr",tableName:"myTableName",worksheetName:"xlsWorksheetName",type:"csv",jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8}},escape:!1,htmlContent:!1,consoleLog:!1,outputMode:"file",fileName:"tableExport",
excelstyles:["border-bottom","border-top","border-left","border-right"]};n=g.extend(!0,a,n);var z=null,v=[];if("csv"==a.type||"txt"==a.type){var d="",m=0;g(this).find("thead").first().find(a.theadSelector).each(function(){d+="\n";q(this,"th,td",m,function(l,h,b){d+=C(l,h,b)+a.csvSeparator});m++;d=g.trim(d);d=g.trim(d).substring(0,d.length-1)});g(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";q(this,"td",m,function(l,h,b){trData+=C(l,h,b)+a.csvSeparator});trData.length>
a.csvSeparator.length&&(d+="\n"+trData);m++;d=g.trim(d).substring(0,d.length-1)});d+="\n";!0===a.consoleLog&&console.log(d);if("string"==a.outputMode)return d;if("base64"==a.outputMode)return w(d);try{var u=new Blob([("csv"==a.type?"\ufeff":"")+d],{type:"text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8"});saveAs(u,a.fileName+"."+a.type)}catch(I){x(a.fileName+"."+a.type,"data:text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8,"+("csv"==a.type?"\ufeff":"")+encodeURIComponent(d))}}else if("sql"==
a.type){m=0;d="INSERT INTO `"+a.tableName+"` (";g(this).find("thead").first().find(a.theadSelector).each(function(){q(this,"th,td",m,function(a,b,e){d+="'"+t(a,b,e)+"',"});m++;d=g.trim(d);d=g.trim(d).substring(0,d.length-1)});d+=") VALUES ";g(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";q(this,"td",m,function(a,b,e){trData+="'"+t(a,b,e)+"',"});3<trData.length&&(d+="("+trData,d=g.trim(d).substring(0,d.length-1),d+="),");m++});d=g.trim(d).substring(0,d.length-1);d+=";";
!0===a.consoleLog&&console.log(d);if("string"==a.outputMode)return d;if("base64"==a.outputMode)return w(d);try{u=new Blob([d],{type:"text/plain;charset=utf-8"}),saveAs(u,a.fileName+".sql")}catch(J){x(a.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(d))}}else if("json"==a.type){var E=[];g(this).find("thead").first().find(a.theadSelector).each(function(){var a=[],b=0;q(this,"th,td",b,function(b,h,d){a.push(t(b,h,d))});E.push(a);b++});var F=[];g(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=
[];q(this,"td",m,function(b,d,f){a.push(t(b,d,f))});0<a.length&&(1!=a.length||""!=a[0])&&F.push(a);m++});n=[];n.push({header:E,data:F});var b=JSON.stringify(n);!0===a.consoleLog&&console.log(b);if("string"==a.outputMode)return b;n=w(b);if("base64"==a.outputMode)return n;try{u=new Blob([b],{type:"application/json;charset=utf-8"}),saveAs(u,a.fileName+".json")}catch(K){x(a.fileName+".json","data:application/json;charset=utf-8;base64,"+n)}}else if("xml"==a.type){var m=0,p='<?xml version="1.0" encoding="utf-8"?>',
p=p+"<tabledata><fields>";g(this).find("thead").first().find(a.theadSelector).each(function(){q(this,"th,td",m,function(a,b,d){p+="<field>"+t(a,b,d)+"</field>"});m++});var p=p+"</fields><data>",A=1;g(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=1,b="";q(this,"td",m,function(d,f,g){b+="<column-"+a+">"+t(d,f,g)+"</column-"+a+">";a++});"<column-1></column-1>"!=b&&(p+='<row id="'+A+'">'+b+"</row>",A++);m++});p+="</data></tabledata>";!0===a.consoleLog&&console.log(p);if("string"==
a.outputMode)return p;n=w(p);if("base64"==a.outputMode)return n;try{u=new Blob([p],{type:"application/xml;charset=utf-8"}),saveAs(u,a.fileName+".xml")}catch(L){x(a.fileName+".xml","data:application/xml;charset=utf-8;base64,"+n)}}else if("excel"==a.type||"doc"==a.type){var m=0,k="<table>";g(this).find("thead").first().find(a.theadSelector).each(function(){k+="<tr>";q(this,"th,td",m,function(b,d,e){if(null!=b){k+="<td style='";for(var f in a.excelstyles)a.excelstyles.hasOwnProperty(f)&&(k+=a.excelstyles[f]+
": "+g(b).css(a.excelstyles[f])+";");k+="'>"+t(b,d,e)+"</td>"}});m++;k+="</tr>"});A=1;g(this).find("tbody").first().find(a.tbodySelector).each(function(){k+="<tr>";q(this,"td",m,function(b,d,e){if(null!=b){k+="<td style='";for(var f in a.excelstyles)a.excelstyles.hasOwnProperty(f)&&(k+=a.excelstyles[f]+": "+g(b).css(a.excelstyles[f])+";");g(b).is("[colspan]")&&(k+="' colspan='"+g(b).attr("colspan"));g(b).is("[rowspan]")&&(k+="' rowspan='"+g(b).attr("rowspan"));k+="'>"+t(b,d,e)+"</td>"}});A++;m++;
k+="</tr>"});a.displayTableName&&(k+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+t(g("<p>"+a.tableName+"</p>"))+"</td></tr>");k+="</table>";!0===a.consoleLog&&console.log(k);b="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+a.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";b+='<meta http-equiv="content-type" content="application/vnd.ms-'+a.type+'; charset=UTF-8">';b=b+'<meta http-equiv="content-type" content="application/'+("excel"==a.type?
"vnd.ms-excel":"msword");b+='; charset=UTF-8">';b+="<head>";"excel"==a.type&&(b+="\x3c!--[if gte mso 9]>",b+="<xml>",b+="<x:ExcelWorkbook>",b+="<x:ExcelWorksheets>",b+="<x:ExcelWorksheet>",b+="<x:Name>",b+=a.worksheetName,b+="</x:Name>",b+="<x:WorksheetOptions>",b+="<x:DisplayGridlines/>",b+="</x:WorksheetOptions>",b+="</x:ExcelWorksheet>",b+="</x:ExcelWorksheets>",b+="</x:ExcelWorkbook>",b+="</xml>",b+="<![endif]--\x3e");b+="</head>";b+="<body>";b+=k;b+="</body>";b+="</html>";if("string"==a.outputMode)return b;
n=w(b);if("base64"==a.outputMode)return n;var G="excel"==a.type?"xls":"doc";try{u=new Blob([b],{type:"application/vnd.ms-"+a.type}),saveAs(u,a.fileName+"."+G)}catch(M){x(a.fileName+"."+G,"data:application/vnd.ms-"+a.type+";base64,"+n)}}else if("png"==a.type)html2canvas(g(this),{onrendered:function(b){b=b.toDataURL();b=b.substring(22);for(var d=atob(b),e=new ArrayBuffer(d.length),f=new Uint8Array(e),g=0;g<d.length;g++)f[g]=d.charCodeAt(g);try{var k=new Blob([e],{type:"image/png"});saveAs(k,a.fileName+
".png")}catch(m){x(a.fileName+".png","data:image/png;base64,"+b)}}});else if("pdf"==a.type){var y=new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);!1===a.jspdf.autotable?(n={dim:{w:D(g(this).first().get(0),"width","mm"),h:D(g(this).first().get(0),"height","mm")},pagesplit:!1},y.addHTML(g(this).first(),a.jspdf.margins.left,a.jspdf.margins.top,n,function(){B(y)})):(a.jspdf.autotable.margins={},g.extend(!0,a.jspdf.autotable.margins,a.jspdf.margins),g(this).each(function(){var b=[],d=[],e=0;
g(this).find("thead").find(a.theadSelector).each(function(){q(this,"th,td",e,function(a,d,e){b.push(t(a,d,e))});e++});g(this).find("tbody").find(a.tbodySelector).each(function(){var a=[];q(this,"td",e,function(b,d,e){a.push(t(b,d,e))});e++;d.push(a)});y.autoTable(b,d,a.jspdf.autotable);a.jspdf.autotable.startY=y.autoTableEndPosY()+a.jspdf.autotable.margins.top}),B(y))}}})})(jQuery);
